{"version":3,"file":"index7.js","sources":["../node_modules/tslib/tslib.es6.js","../src/index7.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","interface GameOptions {\r\n    cycles: number\r\n    zipFile: string\r\n    execCmdArray: string[]\r\n}\r\n\r\ninterface KeyMapping {\r\n    targetKey: string\r\n    replacementKeyCode: number\r\n}\r\n\r\ninterface Directions {\r\n    directions: number\r\n}\r\n\r\ninterface ButtonMapping {\r\n    element:HTMLElement\r\n    asciiCode:number\r\n}\r\n\r\ninterface Origin {\r\n    x: number\r\n    y: number\r\n    id: number\r\n}\r\n\r\ninterface PixelListener {\r\n    x: number\r\n    y: number\r\n    callback: (string) => void\r\n    lastColor: string\r\n}\r\n\r\ninterface DirectionMapping {\r\n    direction:string\r\n    asciiMapping:number\r\n}\r\n\r\n/**\r\n * DosGame. Object and helper methods to make it easier to run DOS games in a browser using DOSBox\r\n * @Author Mark van Wyk\r\n * @copyright Emerge Gaming @copy; 2021\r\n */\r\nexport class DosGame {\r\n\r\n    private dosRef: any;\r\n    private options: GameOptions\r\n    private canvas: HTMLCanvasElement\r\n    private rootElement: HTMLElement\r\n    private emulators: any;\r\n    private ci: any;\r\n    private keysToReplace:KeyMapping[] = []\r\n    private directions:Directions\r\n    private buttons:ButtonMapping[] = []\r\n    private origin:Origin = {x:null, y:null, id:null}\r\n    private lastDirection:string[] = []\r\n    private canvasContext:CanvasRenderingContext2D\r\n    private interval:number\r\n    private pixelListeners:PixelListener[] = []\r\n    private keysDown:string[] = []\r\n    private readonly forceKeyPress:boolean;\r\n    private generalPixelCallback: (colours:string[]) => void;\r\n    private dPadMode:boolean = false;\r\n    private dPadBounds:DOMRect;\r\n    private touchEventListenersAdded:boolean = false;\r\n\r\n    private directionMapping:object = {\r\n        'up': 38,\r\n        'down':40,\r\n        'left':37,\r\n        'right':39\r\n    };\r\n\r\n\r\n    /**\r\n     * Create a new DosGame object.\r\n     * that this object requires the JSDos script to be loaded by the page.\r\n     *\r\n     * eg: <script src=\"/dosbox/js-dos.js\"></script>\r\n     *\r\n     * @param dosRef a reference to window.DOS created by the included JavaScript file\r\n     * @param options {cycles:number, zipFile:string, execCmd:string[]}\r\n     * @param canvas reference to the HTMLCanvasElement DOSBox is being rendered on\r\n     * @param forceKeyPress force simulateKeyPress instead of simulateKeyEvent\r\n     * @see https://js-dos.com/\r\n     */\r\n\r\n\r\n    \r\n\r\n    constructor(dosRef:any, rootElement:HTMLElement, emulators:any, forceKeyPress:boolean = false) {\r\n        this.dosRef = dosRef;\r\n        //this.options = options;\r\n        //this.canvas = <HTMLCanvasElement>rootElement.firstChild\r\n        this.rootElement = rootElement;\r\n        this.forceKeyPress = forceKeyPress;\r\n        this.emulators = emulators;\r\n    }\r\n\r\n\r\n\r\n    \r\n\r\n    public start():Promise<any> {\r\n        return new Promise((resolve) => {\r\n            this.dosRef(this.canvas, {\r\n                cycles: this.options.cycles,\r\n                wdosboxUrl: '/dosbox/wdosbox.js',\r\n                onprogress: () => {},\r\n                log: () => {}\r\n            }).ready((fs, main) => {\r\n                fs.extract(this.options.zipFile).then(() => {\r\n                    main(this.options.execCmdArray).then((ci) => {\r\n                        this.ci = ci;\r\n                        resolve(ci);\r\n                        window.focus();\r\n                        window.addEventListener('unload', this.unload)\r\n                    })\r\n                })\r\n            })\r\n        })\r\n    }\r\n\r\n    public start7(gameBundle: string):Promise<any> {\r\n        return new Promise(async (resolve)=>{\r\n            this.emulators.pathPrefix = \"/dosbox/dos7/\";\r\n            this.dosRef(this.rootElement).run(gameBundle).then((ci)=>{\r\n                console.log(\"CI:\" + ci);\r\n                this.ci = ci;\r\n                resolve(ci);\r\n            });\r\n        })\r\n    }\r\n\r\n    public getCommandInterface():object {\r\n\r\n        return this.ci;\r\n    }\r\n\r\n\r\n    public startWithConf(dosboxConf):Promise<any> {\r\n        return new Promise((resolve) => {\r\n            this.options.execCmdArray.push('-conf');\r\n            this.options.execCmdArray.push('dosbox.conf')\r\n            this.dosRef(this.canvas, {\r\n                wdosboxUrl: '/dosbox/wdosbox.js',\r\n            }).ready((fs, main) => {\r\n                fs.extract(this.options.zipFile).then(() => {\r\n                    fs.createFile(\"dosbox.conf\", dosboxConf);\r\n                    main(this.options.execCmdArray).then((ci) => {\r\n                        this.ci = ci\r\n                        resolve(ci)\r\n                        window.focus();\r\n                        window.addEventListener('unload', this.unload)\r\n                    })\r\n                })\r\n            })\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Capture a key (hopefully before the emulator gets it and replace it with a different key\r\n     * @param targetKey the event.key (not the ascii code) we're looking for.\r\n     * @param replacementKeyCode the ASCII key to send to DOSBox\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key\r\n     */\r\n    public overrideKey(targetKey:string, replacementKeyCode:number):void {\r\n        if (this.keysToReplace.length === 0) this.addKeyEventListeners()\r\n        this.keysToReplace.push({targetKey:targetKey, replacementKeyCode:replacementKeyCode})\r\n    }\r\n\r\n    /**\r\n     * Convert touch dragging to direction keys\r\n     * @param directions can be 8 (including diagonals), 4 (up, down, left right) or 2 (left or right)\r\n     *\r\n     */\r\n    public mapTouchToArrowKeys(directions:Directions):void {\r\n        this.directions = directions\r\n        if (this.buttons.length == 0) {\r\n            this.addTouchEventListeners()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Use the D-Pad instead of the touch dragging (joystick)\r\n     * @param dPadElem the HTMLElement of the bounding (div) of the D-Pad container. Used to assess where the finder is.\r\n     */\r\n    public mapDPadToArrowKeys(dPadElem):void {\r\n\r\n        this.dPadBounds = dPadElem.getBoundingClientRect();this.dPadMode = true;\r\n        this.addTouchEventListeners();\r\n    }\r\n\r\n    /**\r\n     * Map an on-screen button to a keypress.\r\n     * @param buttonMapping the keyCode and asciiCode mapping.\r\n     */\r\n    public mapButtonToKey(buttonMapping:ButtonMapping):void {\r\n        this.buttons.push(buttonMapping)\r\n        if (!this.directions) {\r\n            this.addTouchEventListeners()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Automatically press a key after a certain period of time\r\n     * @param asciiCode the asciiCode of the key to press\r\n     * @param wait the wait period in milliseconds\r\n     */\r\n    public autoKeyPress(asciiCode:number, wait:number = 0):Promise<any> {\r\n        return new Promise<unknown>((resolve, reject) =>\r\n            setTimeout (() => {\r\n                this.ci.simulateKeyPress(asciiCode);\r\n                if (wait > 0 && resolve) resolve(null);\r\n            }, wait)\r\n        )\r\n    }\r\n\r\n    /**\r\n     * Give the x y coordinate of a pixel with a callback to be called when the colour changes\r\n     * @param x coord of pixel\r\n     * @param y coord of pixel\r\n     * @param callback\r\n     * @param delay the number of ms to wait\r\n     * @todo: This should really be called addPixelListener (i.e. more than one)\r\n     * @deprecated use addPixelListener\r\n     */\r\n    public setPixelListener(x:number, y:number, callback, delay:number = 1000) {\r\n        this.addPixelListener(x, y, callback, delay);\r\n    }\r\n\r\n    /**\r\n     * Give the x y coordinate of a pixel with a callback to be called when the colour changes\r\n     * @param x coord of x pixel\r\n     * @param y coord of y pixel\r\n     * @param callback to callback every interval with the pixel colour.\r\n     * @param delay the number of ms between callback intervals\r\n     */\r\n    public addPixelListener(x:number, y:number, callback, delay:number = 1000) {\r\n        if (!this.interval) this.interval = window.setInterval(this.doIntervalPoll.bind(this), delay)\r\n        this.pixelListeners.push({x:x, y:y, callback:callback, lastColor:undefined})\r\n\r\n        if (!this.canvasContext) this.canvasContext = this.canvas.getContext('2d');\r\n    }\r\n\r\n    public setGeneralPixelCallback(callback:(colours:string[]) => void) {\r\n        this.generalPixelCallback = callback;\r\n    }\r\n\r\n    public stopPixelListener() {\r\n        window.clearInterval(this.interval);\r\n    }\r\n\r\n    public consoleScreenshots() {\r\n        setInterval(() => {\r\n            console.log (this.canvas.toDataURL('img/png'));\r\n        }, 1500)\r\n\r\n    }\r\n\r\n    public static isTouch = () => {\r\n        return (('ontouchstart' in window) ||\r\n            (navigator.maxTouchPoints > 0) ||\r\n            (navigator.msMaxTouchPoints > 0));\r\n    }\r\n\r\n    public overrideDirectionAscii = (directionAscii:object) => {\r\n        this.directionMapping = directionAscii;\r\n    }\r\n\r\n    /***** P R I V A T E   M E T H O D S *****/\r\n\r\n    private doIntervalPoll() {\r\n\r\n        let colors:string[] = []\r\n\r\n        this.pixelListeners.forEach((pl) => {\r\n            let pixelColor:ImageData = this.canvasContext.getImageData(pl.x, pl.y, 1, 1);\r\n            let colorValue:string = '#' + DosGame.getHexValue(pixelColor.data[0]) + DosGame.getHexValue(pixelColor.data[1]) + DosGame.getHexValue(pixelColor.data[2]);\r\n            colors.push(colorValue)\r\n            if (colorValue != pl.lastColor) {\r\n                pl.callback(colorValue);\r\n                pl.lastColor = colorValue;\r\n            }\r\n        });\r\n\r\n        if (this.generalPixelCallback) this.generalPixelCallback(colors);\r\n    }\r\n\r\n    private static getHexValue(number:number):string {\r\n        return (\"00\" + number.toString(16)).slice(-2)\r\n    }\r\n\r\n    /**\r\n     * Create key event listeners\r\n     * @private\r\n     */\r\n    private addKeyEventListeners() {\r\n        window.addEventListener('keyup', this.handleKeyEvent.bind(this))\r\n        window.addEventListener('keydown', this.handleKeyEvent.bind(this))\r\n    }\r\n\r\n    /**\r\n     * Create touch listeners\r\n     */\r\n    private addTouchEventListeners() {\r\n        if (!this.touchEventListenersAdded) {\r\n            document.addEventListener('touchstart', this.handleTouchEvent.bind(this))\r\n            document.addEventListener('touchend', this.handleTouchEvent.bind(this))\r\n            document.addEventListener('touchmove', this.handleTouchEvent.bind(this))\r\n            this.touchEventListenersAdded = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * When a key is pressed (keydown) or released (keyup), check to see if it's a mapped key and rather send the\r\n     * preferred key to DosBox.\r\n     * @param event KeyboardEvent of the pressed or released key\r\n     * @private\r\n     */\r\n    private handleKeyEvent(event:KeyboardEvent) {\r\n\r\n        if ((event.type === 'keydown' || event.type === 'keyup') && event.metaKey == false) {\r\n            let keyCode = this.findReplacementKeyCode(event.key);\r\n            if (keyCode) {\r\n                if (event.type === 'keydown' && !this.keysDown.includes(event.key)) {\r\n                    this.forceKeyPress ? this.ci.simulateKeyPress(keyCode, true) : this.ci.simulateKeyEvent(keyCode, true)\r\n                    this.keysDown.push(event.key)\r\n                }\r\n\r\n                if (event.type === 'keyup' && this.keysDown.includes(event.key)) {\r\n                    this.forceKeyPress ? this.ci.simulateKeyPress(keyCode, false) : this.ci.simulateKeyEvent(keyCode, false)\r\n                    this.keysDown.splice(this.keysDown.indexOf(event.key),1);\r\n                }\r\n\r\n                event.stopImmediatePropagation();\r\n                event.stopPropagation();\r\n                event.preventDefault();\r\n            }\r\n        }\r\n    }\r\n\r\n    private findReplacementKeyCode(key:string) {\r\n        return this.keysToReplace.find(item => item.targetKey == key)?.replacementKeyCode || null;\r\n    }\r\n\r\n    /**\r\n     * Handle the touch events\r\n     * @private\r\n     * @param event\r\n     * @todo THIS NEEDS TO BE SIMPLIFIED AND EITHER MOVED TO A DIFFERENT CLASS OR BECOME PART OF A SUPERCLASS\r\n     */\r\n    private handleTouchEvent(event:TouchEvent) {\r\n        if (event.type == 'touchstart') {\r\n            for (let i:number = 0; i < event.changedTouches.length; i++) {\r\n                let startingTouch = event.changedTouches[i]\r\n                if (!this.dPadMode && startingTouch.clientX < 200 ) {\r\n                    this.setOrigin(startingTouch)\r\n                }  else {\r\n                    for (let j:number = 0; j < this.buttons.length; j++) {\r\n\r\n                        if (this.dPadMode) {\r\n\r\n                            let xPct = (startingTouch.clientX - this.dPadBounds.left) / this.dPadBounds.width * 100;\r\n                            let yPct = (startingTouch.clientY - this.dPadBounds.top) / this.dPadBounds.height * 100;\r\n\r\n                            if (xPct >= 0 && xPct <= 100 && yPct > 0 && yPct <= 100) {\r\n                                if (yPct < 33) {\r\n                                    if (xPct > 33 && xPct < 67) {\r\n                                        this.ci.simulateKeyPress(this.directionMapping['up'])\r\n                                    }\r\n                                } else if (yPct < 67) {\r\n                                    if (xPct < 33) {\r\n                                        this.ci.simulateKeyPress(this.directionMapping['left'])\r\n                                    } else if (xPct > 67) {\r\n                                        this.ci.simulateKeyPress(this.directionMapping['right'])\r\n                                    }\r\n                                } else {\r\n                                    if (xPct > 33 && xPct < 67) {\r\n                                        this.ci.simulateKeyPress(this.directionMapping['down'])\r\n                                    }\r\n                                }\r\n                                continue;\r\n                            }\r\n\r\n                        }\r\n\r\n                        let mapping:ButtonMapping = this.buttons[j]\r\n                        let rect = mapping.element.getBoundingClientRect()\r\n                        let x1 = rect.x, x2 = rect.x + rect.width, y1 = rect.y, y2 = rect.y + rect.height;\r\n                        if (startingTouch.clientX > x1 && startingTouch.clientX < x2 && startingTouch.clientY > y1 && startingTouch.clientY < y2) {\r\n                            this.ci.simulateKeyPress(mapping.asciiCode, true)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n        } else if (this.dPadMode == false && event.type == 'touchmove') {\r\n            for (let i:number = 0; i < event.changedTouches.length; i++) {\r\n                let movingTouch:Touch = event.changedTouches[i]\r\n                if (movingTouch.clientX < 200) {\r\n\r\n                    let control = []\r\n                    let dx = movingTouch.clientX - this.origin.x;\r\n                    let dy = movingTouch.clientY - this.origin.y;\r\n                    if (dx === 0 && dy === 0 || isNaN(dx) || isNaN(dy)) return\r\n\r\n                    let rangeInner:number = dy * 0.38;\r\n                    let rangeOuter:number = dy * 2.61;\r\n\r\n                    if (this.directions.directions === 8) {\r\n                        if (dx < -Math.abs(rangeOuter)) {\r\n                            control = ['left']\r\n                        } else if (dy < 0 && dx < rangeInner) {\r\n                            control = ['up','left']\r\n                        } else if (dy < 0 && dx < Math.abs(rangeInner)) {\r\n                            control = ['up']\r\n                        } else if (dy < 0 && dx < -rangeOuter) {\r\n                            control = ['up','right']\r\n                        } else if (dx > Math.abs(rangeOuter)) {\r\n                            control = ['right']\r\n                        } else if (dy > 0 && dx < -Math.abs(rangeInner)) {\r\n                            control = ['down','right']\r\n                        } else if (dy > 0 && dx < rangeInner) {\r\n                            control = ['down']\r\n                        } else if (dy > 0 && dx < dy * rangeOuter) {\r\n                            control = ['down','left']\r\n                        } else {\r\n                            console.error (\"Not a known angle / direction\")\r\n                        }\r\n                    } else if (this.directions.directions === 4) {\r\n                        if (dx < 0 && dx < -Math.abs(dy)) {\r\n                            control = ['left']\r\n                        } else if (dy < 0 && dx < -dy) {\r\n                            control = ['up']\r\n                        } else if (dx > 0 && dx > Math.abs(dy)) {\r\n                            control = ['right']\r\n                        } else if (dy > 0 && dx < dy) {\r\n                            control = ['down']\r\n                        } else {\r\n                            console.error (\"Not a known angle / direction\")\r\n                        }\r\n                    } else if (this.directions.directions === 2) {\r\n                        if (dx < 0) {\r\n                            control = ['left']\r\n                        } else if (dx > 0) {\r\n                            control = ['right']\r\n                        } else {\r\n                            console.error (\"Not a known angle / direction\")\r\n                        }\r\n                    } else {\r\n                        console.error(\"Only 2, 4 or 8 directions allowed\")\r\n                    }\r\n\r\n                    this.processDirectionChange(this.lastDirection, control)\r\n                    this.lastDirection = control;\r\n                }\r\n\r\n            }\r\n        } else if (event.type == 'touchend') {\r\n            for (let i = 0; i < event.changedTouches.length; i++) {\r\n                let endingTouch:Touch = event.changedTouches[i];\r\n                if (endingTouch.identifier === this.origin.id) {\r\n                    this.origin.x = null;\r\n                    this.origin.y = null;\r\n                    this.origin.id = null;\r\n                    if (this.lastDirection.length > 0) {\r\n                        this.processDirectionChange(this.lastDirection, [])\r\n                    }\r\n                    this.lastDirection = [];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Looks for differences between the two arrays and turns on or off new directions\r\n     * eg: The examples in the parameters below will send a key event to the emulator with keyup for left\r\n     * @param was the array from the previous iteration (eg: ['left', 'up'])\r\n     * @param is the array from the previous iteration (eg: ['up'])\r\n     */\r\n    private processDirectionChange = (was, is) => {\r\n\r\n        let turnOff = was.filter(w => is.indexOf(w) === -1)\r\n        let turnOn = is.filter(i => was.indexOf(i) === -1)\r\n        turnOff.forEach((direction) => {\r\n            console.log(\"Key Up: \" + this.getDirectionAscii(direction));\r\n\r\n            this.ci.sendKeyEvent(this.getDirectionAscii(direction), false);\r\n\r\n        });\r\n        turnOn.forEach((direction) => {\r\n            //console.log(this.ci);\r\n            console.log(\"Key Down: \" + this.getDirectionAscii(direction));\r\n\r\n            this.ci.sendKeyEvent(this.getDirectionAscii(direction), true);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns the ascii code for the corresponding arrow key\r\n     * @param direction\r\n     * @private\r\n     */\r\n    private getDirectionAscii(direction:string):number {\r\n        return this.directionMapping[direction];\r\n    }\r\n\r\n    /**\r\n     * Convert radians tp degrees\r\n     * @param rad the angle in radians\r\n     */\r\n    private radToDeg = (rad) => {\r\n        return Math.round(rad * 180 / Math.PI);\r\n    }\r\n\r\n    /**\r\n     * Set the starting point (touch)\r\n     * @param touchEvent the touch event where the movement started\r\n     * @private\r\n     */\r\n    private setOrigin(touchEvent:Touch) {\r\n        this.origin = {x:touchEvent.clientX, y:touchEvent.clientY, id:touchEvent.identifier}\r\n    }\r\n\r\n    /**\r\n     * When a user clicks away, unload the WASM code\r\n     * @private\r\n     */\r\n    private unload() {\r\n        this.dosRef.exit();\r\n    }\r\n\r\n}\r\n"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","this","n","v","op","TypeError","call","pop","length","push","dosRef","rootElement","emulators","forceKeyPress","x","id","up","down","left","right","directionAscii","_this","directionMapping","was","is","turnOff","filter","w","indexOf","turnOn","i","forEach","direction","console","log","getDirectionAscii","ci","sendKeyEvent","rad","Math","round","PI","DosGame","canvas","cycles","options","wdosboxUrl","onprogress","ready","fs","main","extract","zipFile","execCmdArray","window","focus","addEventListener","unload","gameBundle","pathPrefix","run","dosboxConf","createFile","targetKey","replacementKeyCode","keysToReplace","addKeyEventListeners","directions","buttons","addTouchEventListeners","dPadElem","dPadBounds","getBoundingClientRect","dPadMode","buttonMapping","asciiCode","wait","setTimeout","simulateKeyPress","callback","delay","addPixelListener","interval","setInterval","doIntervalPoll","bind","pixelListeners","lastColor","undefined","canvasContext","getContext","generalPixelCallback","clearInterval","toDataURL","colors","pl","pixelColor","getImageData","colorValue","getHexValue","data","number","toString","slice","handleKeyEvent","touchEventListenersAdded","document","handleTouchEvent","event","type","metaKey","keyCode","findReplacementKeyCode","key","keysDown","includes","simulateKeyEvent","splice","stopImmediatePropagation","stopPropagation","preventDefault","find","item","changedTouches","startingTouch","clientX","setOrigin","j","xPct","width","yPct","clientY","top","height","mapping","rect","element","x1","x2","y1","y2","movingTouch","control","dx","origin","dy","isNaN","rangeInner","rangeOuter","abs","error","processDirectionChange","lastDirection","identifier","touchEvent","exit","navigator","maxTouchPoints","msMaxTouchPoints"],"mappings":"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"}