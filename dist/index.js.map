{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["interface GameOptions {\n    cycles: number\n    zipFile: string\n    execCmd: string\n}\n\ninterface KeyMapping {\n    targetKey: string\n    replacementKeyCode: number\n}\n\nexport class DosGame {\n\n    private dosRef: any;\n    private options: GameOptions;\n    private canvas: HTMLCanvasElement\n    private ci: any\n    private keysToReplace:any[] = [];\n\n    constructor(dosRef, options, canvas) {\n        this.dosRef = dosRef;\n        this.options = options\n        this.canvas = canvas;\n    }\n\n    start() {\n        return new Promise((resolve, reject):any => {\n            this.dosRef(this.canvas, {\n                cycles: this.options.cycles,\n                wdosboxUrl: '/dosbox/wdosbox.js',\n                onprogress: () => {},\n                log: () => {}\n            }).ready((fs, main) => {\n                fs.extract(this.options.zipFile).then(() => {\n                    main([\"-c\", this.options.execCmd]).then((ci) => {\n                        this.ci = ci;\n                        resolve(ci);\n                        window.addEventListener('unload', this.unload);\n                    })\n                })\n            })\n        })\n    }\n\n    /**\n     * Capture a key (hopefully before the emulator gets it and replace it with a different key\n     * @param targetKey\n     * @param replacementKeyCode\n     */\n    overrideKey(targetKey:string, replacementKeyCode:number): void {\n        if (this.keysToReplace.length === 0) this.addKeyEventListeners();\n        this.keysToReplace.push({targetKey:targetKey, replacementKeyCode:replacementKeyCode});\n    }\n\n    /** Private Methods **/\n\n    private addKeyEventListeners() {\n        window.addEventListener('keypress', this.handleKeyEvent.bind(this))\n        window.addEventListener('keyup', this.handleKeyEvent.bind(this))\n    }\n\n    /** Needs work **/\n    private handleKeyEvent(event:KeyboardEvent) {\n        console.log('poo')\n        if (event.key) {\n            this.keysToReplace.filter(item => {\n                if (item.targetKey == event.key) {\n                    event.preventDefault();\n                    event.stopImmediatePropagation()\n                    console.log(event.type);\n                    this.ci.simulateKeyPress(item.replacementKeyCode)\n\n                }\n            })\n        }\n    }\n\n    private unload() {\n        this.ci.exit();\n    }\n}\n"],"names":["dosRef","options","canvas","this","DosGame","Promise","resolve","reject","_this","cycles","wdosboxUrl","onprogress","log","ready","fs","main","extract","zipFile","then","execCmd","ci","window","addEventListener","unload","targetKey","replacementKeyCode","keysToReplace","length","addKeyEventListeners","push","handleKeyEvent","bind","event","console","key","filter","item","preventDefault","stopImmediatePropagation","type","simulateKeyPress","exit"],"mappings":"iBAmBI,WAAYA,EAAQC,EAASC,GAFrBC,mBAAsB,GAG1BA,KAAKH,OAASA,EACdG,KAAKF,QAAUA,EACfE,KAAKD,OAASA,EA0DtB,OAvDIE,kBAAA,WAAA,WACI,OAAO,IAAIC,SAAQ,SAACC,EAASC,GACzBC,EAAKR,OAAOQ,EAAKN,OAAQ,CACrBO,OAAQD,EAAKP,QAAQQ,OACrBC,WAAY,qBACZC,WAAY,aACZC,IAAK,eACNC,OAAM,SAACC,EAAIC,GACVD,EAAGE,QAAQR,EAAKP,QAAQgB,SAASC,MAAK,WAClCH,EAAK,CAAC,KAAMP,EAAKP,QAAQkB,UAAUD,MAAK,SAACE,GACrCZ,EAAKY,GAAKA,EACVd,EAAQc,GACRC,OAAOC,iBAAiB,SAAUd,EAAKe,qBAY3DnB,wBAAA,SAAYoB,EAAkBC,GACQ,IAA9BtB,KAAKuB,cAAcC,QAAcxB,KAAKyB,uBAC1CzB,KAAKuB,cAAcG,KAAK,CAACL,UAAUA,EAAWC,mBAAmBA,KAK7DrB,iCAAR,WACIiB,OAAOC,iBAAiB,WAAYnB,KAAK2B,eAAeC,KAAK5B,OAC7DkB,OAAOC,iBAAiB,QAASnB,KAAK2B,eAAeC,KAAK5B,QAItDC,2BAAR,SAAuB4B,GAAvB,WACIC,QAAQrB,IAAI,OACRoB,EAAME,KACN/B,KAAKuB,cAAcS,QAAO,SAAAC,GAClBA,EAAKZ,WAAaQ,EAAME,MACxBF,EAAMK,iBACNL,EAAMM,2BACNL,QAAQrB,IAAIoB,EAAMO,MAClB/B,EAAKY,GAAGoB,iBAAiBJ,EAAKX,yBAOtCrB,mBAAR,WACID,KAAKiB,GAAGqB"}