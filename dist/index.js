var t=function(){function t(t,e,n){var i=this;this.keysToReplace=[],this.buttons=[],this.pressedButtons=[],this.origin={x:null,y:null,id:null},this.lastDirection=[],this.processDirectionChange=function(t,e){console.log("was ",t),console.log("is ",e),console.log("---");var n=t.filter((function(t){return-1===e.indexOf(t)})),o=e.filter((function(e){return-1===t.indexOf(e)}));n.forEach((function(t){console.log("ending "+t),i.ci.simulateKeyEvent(i.getDirectionAscii(t),!1)})),o.forEach((function(t){console.log("starting "+t),i.ci.simulateKeyEvent(i.getDirectionAscii(t),!0)}))},this.radToDeg=function(t){return Math.round(180*t/Math.PI)},this.dosRef=t,this.options=e,this.canvas=n}return t.prototype.start=function(){var t=this;return new Promise((function(e){t.dosRef(t.canvas,{cycles:t.options.cycles,wdosboxUrl:"/dosbox/wdosbox.js",onprogress:function(){},log:function(){}}).ready((function(n,i){n.extract(t.options.zipFile).then((function(){i(["-c",t.options.execCmd]).then((function(n){t.ci=n,e(n),window.addEventListener("unload",t.unload)}))}))}))}))},t.prototype.overrideKey=function(t,e){0===this.keysToReplace.length&&this.addKeyEventListeners(),this.keysToReplace.push({targetKey:t,replacementKeyCode:e})},t.prototype.mapTouchToArrowKeys=function(t){this.directions=t,0==this.buttons.length&&this.addTouchEventListeners()},t.prototype.mapButtonToKey=function(t){this.buttons.push(t),this.directions||this.addTouchEventListeners()},t.prototype.addKeyEventListeners=function(){window.addEventListener("keyup",this.handleKeyEvent.bind(this)),window.addEventListener("keydown",this.handleKeyEvent.bind(this))},t.prototype.addTouchEventListeners=function(){document.addEventListener("touchstart",this.handleTouchEvent.bind(this)),document.addEventListener("touchend",this.handleTouchEvent.bind(this)),document.addEventListener("touchmove",this.handleTouchEvent.bind(this))},t.prototype.handleKeyEvent=function(t){if(t.key)for(var e=0;e<this.keysToReplace.length;e++){var n=this.keysToReplace[e];t.key==n.targetKey&&(t.preventDefault(),t.stopImmediatePropagation(),this.ci.simulateKeyEvent(n.replacementKeyCode,"keydown"==t.type))}},t.prototype.handleTouchEvent=function(t){if("touchstart"==t.type)for(var e=0;e<t.changedTouches.length;e++){var n=t.changedTouches[e];if(n.clientX<200)this.setOrigin(n);else for(var i=0;i<this.buttons.length;i++){var o=this.buttons[i],s=o.element.getBoundingClientRect(),r=s.x,c=s.x+s.width,h=s.y,a=s.y+s.height;n.clientX>r&&n.clientX<c&&n.clientY>h&&n.clientY<a&&(this.pressedButtons.push({id:n.identifier,x:n.clientX,y:n.clientY,elem:o.element}),this.ci.simulateKeyPress(o.asciiCode,!0))}}else if("touchmove"==t.type)for(e=0;e<t.changedTouches.length;e++){var d=t.changedTouches[e];if(d.clientX<200){var l=[],u=d.clientX-this.origin.x,p=d.clientY-this.origin.y;if(0===u&&0===p)return;var f=Math.sqrt(Math.pow(u,2)+Math.pow(p,2)),g=this.radToDeg(Math.asin(p/f))+90;u<0&&(g=180-g+180),4===this.directions.directions?g>=315||g<45?l=["up"]:g>=45&&g<135?l=["right"]:g>=135&&g<225?l=["down"]:g>=225&&g<315?l=["left"]:console.error("unknown angle "+g):8===this.directions.directions?g>=338||g<23?l=["up"]:g>=23&&g<68?l=["up","right"]:g>=68&&g<113?l=["right"]:g>=113&&g<158?l=["down","right"]:g>=158&&g<203?l=["down"]:g>=203&&g<248?l=["down","left"]:g>=248&&g<293?l=["left"]:g>=293&&g<338?l=["up","left"]:console.error("unknown angle "+g):console.error("directions need to be 4 or 8"),this.processDirectionChange(this.lastDirection,l),this.lastDirection=l}}else if("touchend"==t.type)for(e=0;e<t.changedTouches.length;e++){t.changedTouches[e].identifier===this.origin.id&&(this.origin.x=null,this.origin.y=null,this.origin.id=null,this.lastDirection.length>0&&this.processDirectionChange(this.lastDirection,[]),this.lastDirection=[])}},t.prototype.getDirectionAscii=function(t){switch(t){case"up":return 38;case"down":return 40;case"left":return 37;case"right":return 39}},t.prototype.setOrigin=function(t){this.origin={x:t.clientX,y:t.clientY,id:t.identifier}},t.prototype.unload=function(){this.ci.exit()},t}();export{t as DosGame};
//# sourceMappingURL=index.js.map
