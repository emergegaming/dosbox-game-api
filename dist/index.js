var t=function(){function t(e,i,n){var o=this;this.keysToReplace=[],this.buttons=[],this.origin={x:null,y:null,id:null},this.lastDirection=[],this.processDirectionChange=function(e,i){var n=e.filter((function(t){return-1===i.indexOf(t)})),s=i.filter((function(t){return-1===e.indexOf(t)}));n.forEach((function(e){console.log(e+" off"),o.ci.simulateKeyEvent(t.getDirectionAscii(e),!1)})),s.forEach((function(e){console.log(e+" on"),o.ci.simulateKeyEvent(t.getDirectionAscii(e),!0)}))},this.radToDeg=function(t){return Math.round(180*t/Math.PI)},this.dosRef=e,this.options=i,this.canvas=n}return t.prototype.start=function(){var t=this;return new Promise((function(e){t.dosRef(t.canvas,{cycles:t.options.cycles,wdosboxUrl:"/dosbox/wdosbox.js",onprogress:function(){},log:function(){}}).ready((function(i,n){i.extract(t.options.zipFile).then((function(){n(t.options.execCmdArray).then((function(i){t.ci=i,e(i),window.addEventListener("unload",t.unload)}))}))}))}))},t.prototype.overrideKey=function(t,e){0===this.keysToReplace.length&&this.addKeyEventListeners(),this.keysToReplace.push({targetKey:t,replacementKeyCode:e})},t.prototype.mapTouchToArrowKeys=function(t){this.directions=t,0==this.buttons.length&&this.addTouchEventListeners()},t.prototype.mapButtonToKey=function(t){this.buttons.push(t),this.directions||this.addTouchEventListeners()},t.prototype.autoKeyPress=function(t,e){var i=this;return new Promise((function(n,o){return setTimeout((function(){i.ci.simulateKeyPress(t),n(null)}),e)}))},t.prototype.setPixelListener=function(t,e,i,n){void 0===n&&(n=1e3),window.clearInterval(this.interval),this.pixelListener={x:t,y:e,callback:i},this.canvasContext=this.canvas.getContext("2d"),this.interval=window.setInterval(this.doIntervalPoll.bind(this),n)},t.prototype.stopPixelListener=function(){window.clearInterval(this.interval)},t.prototype.consoleScreenshots=function(){var t=this;setInterval((function(){console.log(t.canvas.toDataURL("img/png"))}),1500)},t.prototype.doIntervalPoll=function(){var e=this.canvasContext.getImageData(this.pixelListener.x,this.pixelListener.y,1,1),i="#"+t.getHexValue(e.data[0])+t.getHexValue(e.data[1])+t.getHexValue(e.data[2]);i!=this.lastPixelValue&&(this.pixelListener.callback(i),this.lastPixelValue=i)},t.getHexValue=function(t){return("00"+t.toString(16)).slice(-2)},t.prototype.addKeyEventListeners=function(){window.addEventListener("keyup",this.handleKeyEvent.bind(this)),window.addEventListener("keydown",this.handleKeyEvent.bind(this))},t.prototype.addTouchEventListeners=function(){document.addEventListener("touchstart",this.handleTouchEvent.bind(this)),document.addEventListener("touchend",this.handleTouchEvent.bind(this)),document.addEventListener("touchmove",this.handleTouchEvent.bind(this))},t.prototype.handleKeyEvent=function(t){if(t.key)for(var e=0;e<this.keysToReplace.length;e++){var i=this.keysToReplace[e];t.key==i.targetKey&&(t.preventDefault(),t.stopImmediatePropagation(),i.replacementKeyCode&&this.ci.simulateKeyEvent(i.replacementKeyCode,"keydown"==t.type))}},t.prototype.handleTouchEvent=function(t){if("touchstart"==t.type)for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];if(i.clientX<200)this.setOrigin(i);else for(var n=0;n<this.buttons.length;n++){var o=this.buttons[n],s=o.element.getBoundingClientRect(),r=s.x,a=s.x+s.width,c=s.y,h=s.y+s.height;i.clientX>r&&i.clientX<a&&i.clientY>c&&i.clientY<h&&this.ci.simulateKeyPress(o.asciiCode,!0)}}else if("touchmove"==t.type)for(e=0;e<t.changedTouches.length;e++){var l=t.changedTouches[e];if(l.clientX<200){var u=[],d=l.clientX-this.origin.x,p=l.clientY-this.origin.y;if(0===d&&0===p||isNaN(d)||isNaN(p))return;var f=.38*p,g=2.61*p;8===this.directions.directions?d<-Math.abs(g)?u=["left"]:p<0&&d<f?u=["up","left"]:p<0&&d<Math.abs(f)?u=["up"]:p<0&&d<-g?u=["up","right"]:d>Math.abs(g)?u=["right"]:p>0&&d<-Math.abs(f)?u=["down","right"]:p>0&&d<f?u=["down"]:p>0&&d<p*g?u=["down","left"]:console.log("Not a known angle / direction"):4===this.directions.directions?d<0&&d<-Math.abs(p)?u=["left"]:p<0&&d<-p?u=["up"]:d>0&&d>Math.abs(p)?u=["right"]:p>0&&d<p?u=["down"]:console.log("Not a known angle / direction"):2===this.directions.directions?d<0?u=["left"]:d>0?u=["right"]:console.log("Not a known angle / direction"):console.error("Only 2, 4 or 8 directions allowed"),this.processDirectionChange(this.lastDirection,u),this.lastDirection=u}}else if("touchend"==t.type)for(e=0;e<t.changedTouches.length;e++){t.changedTouches[e].identifier===this.origin.id&&(this.origin.x=null,this.origin.y=null,this.origin.id=null,this.lastDirection.length>0&&this.processDirectionChange(this.lastDirection,[]),this.lastDirection=[])}},t.getDirectionAscii=function(t){switch(t){case"up":return 38;case"down":return 40;case"left":return 37;case"right":return 39}},t.prototype.setOrigin=function(t){this.origin={x:t.clientX,y:t.clientY,id:t.identifier}},t.prototype.unload=function(){this.ci.exit()},t.isTouch=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},t}();export{t as DosGame};
//# sourceMappingURL=index.js.map
