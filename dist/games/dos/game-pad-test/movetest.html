<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">

    <title>Gamepad API buttons test page</title>

    <link rel="stylesheet" href="">
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <style>
      #ball {
        width: 40px;
        height: 40px;
        border-radius: 20px;
        background-color: red;

        background-image: -webkit-radial-gradient(40% 40%, circle, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.4));;
        background-image: -moz-radial-gradient(40% 40%, circle, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.4));;
        background-image: -ms-radial-gradient(40% 40%, circle, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.4));;
        background-image: radial-gradient(circle at 40% 40%, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.4));

        position: relative;
      }
    </style>
  </head>

  <body>
    <p id="gamepad-info">Waiting for Gamepad.</p>
    <div id="ball"></div>

  </body>

<script>
  translateGamePad = new Map();

    this.translateGamePad.set(0, "X")//space
    this.translateGamePad.set(1, "O")//up
    this.translateGamePad.set(2, "◻")//down
    this.translateGamePad.set(3, "△")//left
    this.translateGamePad.set(4, "L1")//left
    this.translateGamePad.set(5, "R1")//left
    this.translateGamePad.set(6, "L2")//left
    this.translateGamePad.set(7, "R2")//left
    this.translateGamePad.set(8, "Back")//left
    this.translateGamePad.set(9, "Start")//left
    this.translateGamePad.set(10, "LSC")//left stick click
    this.translateGamePad.set(11, "RSC")//right stick click
    this.translateGamePad.set(12, "DPUp")//left
    this.translateGamePad.set(13, "DPDown")//left
    this.translateGamePad.set(14, "DPLeft")//left
    this.translateGamePad.set(15, "DPRight")//left
    this.translateGamePad.set(16, "Home")//left
    this.translateGamePad.set(17, "TrackPad")//left

var gamepadInfo = document.getElementById("gamepad-info");
var ball = document.getElementById("ball");
var start;
var a = 0;
var b = 0;

var rAF = window.mozRequestAnimationFrame ||
  window.webkitRequestAnimationFrame ||
  window.requestAnimationFrame;

var rAFStop = window.mozCancelRequestAnimationFrame ||
  window.webkitCancelRequestAnimationFrame ||
  window.cancelRequestAnimationFrame;

window.addEventListener("gamepadconnected", function() {
  var gp = navigator.getGamepads()[0];
  

  gameLoop();
});

window.addEventListener("gamepaddisconnected", function() {
  gamepadInfo.innerHTML = "Waiting for gamepad.";

  
});

if(!('GamepadEvent' in window)) {
  // No gamepad events available, poll instead.
  var interval = setInterval(pollGamepads, 500);
}

function pollGamepads() {
  var gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads : []);
  for (var i = 0; i < gamepads.length; i++) {
    var gp = gamepads[i];
    if(gp) {
      
      
      clearInterval(interval);
    }
  }
}

function buttonPressed(b) {
  if (typeof(b) == "object") {
    return b.pressed;
  }
  return b == 1.0;
}

function gameLoop() {
  var gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads : []);
  if (!gamepads)
    return;

  var gp = gamepads[0];
  let bX = 0;
  let bO = 1;
  let bSq = 2;
  let bTr = 3;
  let bL1 = 4;
  let bR1 = 5;
  let bL2 = 6;
  let bR2 = 7;
  let bBack = 8;
  let bStart = 9;
  let bLSC = 10;
  let bRSC = 11;
  let bDPUp = 12;
  let bDPDown = 13;
  let bDPLeft = 14;
  let bDPRight = 15;
  let bHome = 16;
  let bTrackPad = 17;

  if (buttonPressed(gp.buttons[bX])) {
    console.log(translateGamePad.get(bX));
    
    b--;
  } else if (buttonPressed(gp.buttons[2])) {
    console.log(translateGamePad.get(bSq));
    b++;
  } else if(buttonPressed(gp.buttons[1])) {
    console.log(translateGamePad.get(bO));
    a++;
  } else if(buttonPressed(gp.buttons[3])) {
    console.log(translateGamePad.get(bTr));
    a--;
  } else if(buttonPressed(gp.buttons[4])) {
    console.log(translateGamePad.get(bL1));
    a++;
  } else if(buttonPressed(gp.buttons[5])) {
    console.log(translateGamePad.get(bR1));
    a--;
  } else if(buttonPressed(gp.buttons[6])) {
    console.log(translateGamePad.get(bL2));
    a++;
  } else if(buttonPressed(gp.buttons[7])) {
    console.log(translateGamePad.get(bR2));
    a--;
  } else if(buttonPressed(gp.buttons[8])) {
    console.log(translateGamePad.get(bBack));
    a--;
  } else if(buttonPressed(gp.buttons[9])) {
    console.log(translateGamePad.get(bStart));
    a--;
  } else if(buttonPressed(gp.buttons[10])) {
    console.log(translateGamePad.get(bLSC));
    a--;
  } else if(buttonPressed(gp.buttons[11])) {
    console.log(translateGamePad.get(bRSC));
    a--;
  } else if(buttonPressed(gp.buttons[12])) {
    console.log(translateGamePad.get(bDPUp));
    a--;
  } else if(buttonPressed(gp.buttons[13])) {
    console.log(translateGamePad.get(bDPDown));
    a--;
  } else if(buttonPressed(gp.buttons[14])) {
    console.log(translateGamePad.get(bDPLeft));
    a--;
  } else if(buttonPressed(gp.buttons[15])) {
    console.log(translateGamePad.get(bDPRight));
    a--;
  } else if(buttonPressed(gp.buttons[16])) {
    console.log(translateGamePad.get(bHome));
    a--;
  } else if(buttonPressed(gp.buttons[17])) {
    console.log(translateGamePad.get(bTrackPad));
    a--;
  }

  ball.style.left = a*2 + "px";
  ball.style.top = b*2 + "px";

  var start = rAF(gameLoop);
};


</script>
</html>